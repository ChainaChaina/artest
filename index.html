<!DOCTYPE html>
<html>
  <head>
    <title>AR.js Location-based App with Distance Detection</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://rawcdn.githack.com/AR-js-org/AR.js/3.3.2/aframe/build/aframe-ar.js"></script>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <a-scene
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true;"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
      gps-camera
      gps-projected-camera="minDistance: 5;"
    >
      <!-- Objeto 3D que muda conforme a distância -->
      <a-box 
        id="dynamic-box"
        gps-projected-entity-place="latitude: -23.561414; longitude: -46.655881;"
        material="color: yellow; opacity: 0.8;"
        position="0 1.5 0"
        scale="1 1 1"
      ></a-box>

      <!-- Câmera com GPS -->
      <a-camera gps-projected-camera rotation-reader></a-camera>
    </a-scene>

    <script>
      const targetLatitude = -23.561414;
      const targetLongitude = -46.655881;
      const targetElement = document.getElementById("dynamic-box");

      // Função para calcular distância entre duas coordenadas
      function calculateDistance(lat1, lon1, lat2, lon2) {
        const R = 6371e3; // Raio da Terra em metros
        const φ1 = lat1 * (Math.PI / 180);
        const φ2 = lat2 * (Math.PI / 180);
        const Δφ = (lat2 - lat1) * (Math.PI / 180);
        const Δλ = (lon2 - lon1) * (Math.PI / 180);

        const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                  Math.cos(φ1) * Math.cos(φ2) *
                  Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

        return R * c; // Retorna a distância em metros
      }

      // Evento para monitorar a posição GPS do usuário
      document.querySelector("[gps-camera]").addEventListener("gps-camera-update-position", function(e) {
        const userLatitude = e.detail.position.latitude;
        const userLongitude = e.detail.position.longitude;

        // Calcula a distância entre o usuário e o objeto
        const distance = calculateDistance(userLatitude, userLongitude, targetLatitude, targetLongitude);
        console.log(`Distância do objeto: ${distance} metros`);

        // Atualiza o objeto conforme a distância
        if (distance < 10) {
          targetElement.setAttribute("scale", "2 2 2"); // Aumenta o objeto se estiver perto
          targetElement.setAttribute("material", "color", "green");
        } else if (distance < 50) {
          targetElement.setAttribute("scale", "1.5 1.5 1.5"); // Ajusta o tamanho moderadamente
          targetElement.setAttribute("material", "color", "yellow");
        } else {
          targetElement.setAttribute("scale", "1 1 1"); // Volta ao tamanho original
          targetElement.setAttribute("material", "color", "red");
        }
      });
    </script>
  </body>
</html>


